<div id="content">
  <script>
    let maxCharacters = 20;
    let secret =
      "{{secret}}".substring(0, maxCharacters) +
      ("{{secret}}".length > maxCharacters ? "..." : "");

    window.addEventListener("htmx:load", (event) => {
      // Initialize secret visibility on load
      const secretElement = document.getElementById("secret");
      if (secretElement) {
        secretElement.innerText = secret.replace(/./g, "*");
      }
    });

    function copySecret() {
      const btn = document.getElementById("copyButton");

      navigator.clipboard.writeText("{{secret}}").then(() => {
        const oldText = btn.textContent;
        btn.textContent = "Copied!";
        btn.disabled = true;
        btn.classList.add("btn-success");

        setTimeout(() => {
          btn.textContent = oldText;
          btn.disabled = false;
          btn.classList.remove("btn-success");
        }, 1000);
      });
    }

    function toggleSecretVisibility() {
      const secretElement = document.getElementById("secret");
      if (secretElement.innerText.includes("*")) {
        secretElement.innerText = secret;
      } else {
        secretElement.innerText = secret.replace(/./g, "*");
      }
    }
  </script>
  <style>
    .progress-bar.indeterminate {
      position: relative;
      animation: progress-indeterminate 5s infinite;
    }

    @keyframes progress-indeterminate {
      from {
        left: -25%;
        width: 25%;
      }
      to {
        left: 100%;
        width: 25%;
      }
    }
  </style>

  <div class="container">
    <div class="row">
      <!-- events card -->
      <div class="col align-content-center">
        <div class="card">
          <h5 class="card-header">
            Events for project <span style="font-style: italic">{{name}}</span>
          </h5>
          <div class="card-body">
            <div
              hx-get="/api/project/{{id}}/events"
              hx-trigger="every 2s"
              hx-swap="innerHTML"
            >
              <div>
                <div
                  class="progress mb-2"
                  role="progressbar"
                  aria-label="loading bar"
                >
                  <div
                    class="progress-bar progress-bar-striped progress-bar-animated indeterminate"
                  ></div>
                </div>
                <span class="fst-italic">Waiting for new events...</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- secrets card -->
      <div class="col align-content-center col-6">
        <div class="card">
          <h5 class="card-header">Secrets</h5>
          <div class="card-body">
            <div class="card-text overflow-hidden">
              <p class="text-truncate">
                API Key: <span class="font-monospace">{{apiKey}}</span>
              </p>
              <p class="text-truncate">
                Secret:
                <span
                  class="font-monospace text-truncate overflow-scroll"
                  id="secret"
                  >*****</span
                >
                <button
                  class="btn btn-sm btn-outline-secondary"
                  hx-on:click="toggleSecretVisibility()"
                >
                  Show/Hide
                </button>
                <button
                  id="copyButton"
                  class="btn btn-sm btn-outline-secondary"
                  onclick="copySecret()"
                >
                  Copy
                </button>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row"></div>
  </div>

  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-danger"
      hx-delete="/api/project/{{id}}"
      hx-confirm="Are you sure you want to delete this project?"
      hx-trigger="click"
      hx-swap="none"
    >
      Delete
    </button>
  </div>
</div>
